# Schema与数据类型优化


## 选择优化的数据类型

选择正确的数据类型对于获得高性能至关重要，不管存储哪种类型的数据，下面几个简单的原则有助于我们做出更好的选择
- **更小的通常更好**：一般情况下尽量使用可以正确存储数据的最小数据类型，更小的数据类型通常更快。
- **简单就好**：简单数据类型的操作通常需要更少的CPU周期。例如：使用MySQL內建的类型而不是字符串来存储日期，使用整数来存储ip
- **尽量避免NULL**:通常情况下最好指定列为NOT NULL，可为NULL的列使得索引、索引统计和值比较都更复杂。可为NULL的列会使用更多的存储空间，在MySQL里也需要特殊处理。

### 整数类型

整数类型有可选的UNSIGNED属性，表示不允许负值，这可以使正数的上限提升一倍。例如：TINYINT UNSIGNED可以存储的范围是0-255，而TINYINT的存储范围是-128~127。在必要的情况下可以加上UNSIGNED属性，根据需要来添加。

### 实数类型

FLOAT和DOUBLE类型支持使用标准的浮点运算进行近似计算，DECIMAL类型用于存储精确的小数，在MySQL5.0和更好版本，支持精确计算。

浮点和DECIMAL类型都可以指定精度。对于DECLIMAL，可以指定小数点前后所允许的最大位数，会影响列的空间消耗。例如：DECIMAL（18,9)小数点两边将各存储9个数字，一共使用9个字节：小数点前的数字用4个字节，小数点后的数字用4个字节，小数点本身占1个字节。建议只使用数据类型不指定精度。MySQL使用DOUBLE作为内部浮点计算的类型。

尽量只在对小数进行精确计算的时才使用DECIMAL（存储财务数据）。在数据量比较大的时候，可以采用BIGINT来代替DECIMAL，将需要存储的货币单位根据小数的位数乘以相应的倍数即可。例如：存储的财务数据精确到万分之一，可以把所有的金额乘以一百万，然后将结果存储在BIGINT里，这样可以同时避免浮点存储计算不精确和DECIMAL精确计算代价高的问题。


### 字符串类型

#### VARCHAR
最常见的字符串数据类型，它比定长类型更节省空间，因为它仅使用必要的空间。VARCHAR需要额外1或2个字节记录字符串长度。VARCHAR在UPDATE时可能使行变得比原来更长，这就导致需要做额外的工作。

#### CHAR

CHAR类型是定长的，在存储CHAR值时，MySQL会删除所有的末尾空格。CHAR适合存储很短的字符串，或者所有值都接近同一个长度。对于经常变更的数据，CHAR也比VARCHAR在存储空间上也更有效率。


